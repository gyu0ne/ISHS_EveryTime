{% extends "base.html" %}

{% block title %}log인곽 - {{ profile_user.nickname }}님의 프로필{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/my_page.css') }}">
    <script src="{{ url_for('static', filename='js/my_page.js') }}"></script>
{% endblock %}

{% block content %}
<div class="mypage-container">
    <main class="content-wrapper">
        <aside class="profile-sidebar">
            <div class="card profile-card">
                <div class="profile-picture">
                    <img src="{{ url_for('static', filename=profile_user.profile_image) }}" alt="프로필 사진">
                </div>
                <h2 class="nickname">{{ profile_user.nickname }}</h2>
                <div class="level-info">
                    <span>Lv. {{ profile_user.level }}</span>
                    <div class="exp-bar">
                        <div class="exp-gauge" style="width: {{ profile_user.exp/10 }}%;"></div>
                    </div>
                    <span class="exp-text">{{ profile_user.exp }} / 1000 EXP</span>
                </div>
                
                {# --- 수정: 프로필 공개 또는 본인일 때만 소개 메시지 표시 --- #}
                {% if profile_user.profile_public == 1 or is_own_profile %}
                <div class="profile-message">
                    <p>{{ profile_user.profile_message or '소개 메시지가 없습니다.' }}</p>
                </div>
                {% else %}
                <div class="profile-message">
                    <p>비공개 프로필입니다.</p>
                </div>
                {% endif %}
            </div>

            <div class="card user-details">
                <h3>소속 동아리</h3>
                {# --- 수정: 프로필 비공개 시 '비공개' 텍스트 표시 --- #}
                {% if profile_user.profile_public == 1 or is_own_profile %}
                <ul>
                    <li><span>학술</span><strong>{{ profile_user.clubhak or '없음' }}</strong></li>
                    <li><span>취미</span><strong>{{ profile_user.clubchi or '없음' }}</strong></li>
                    <li><span>진로탐색</span><strong>{{ profile_user.clubjin or '없음' }}</strong></li>
                </ul>
                {% else %}
                <ul>
                    <li><span>학술</span><strong>비공개</strong></li>
                    <li><span>취미</span><strong>비공개</strong></li>
                    <li><span>진로탐색</span><strong>비공개</strong></li>
                </ul>
                {% endif %}
            </div>
            
            <div class="card user-details">
                <h3>개인 정보</h3>
                {# --- 수정: 프로필 비공개 시 '비공개' 텍스트 표시 --- #}
                {% if profile_user.profile_public == 1 or is_own_profile %}
                <ul>
                    <li><span>이름</span><strong>{{ profile_user.name }}</strong></li>
                    <li><span>학번</span><strong>{{ profile_user.hakbun }}</strong></li>
                    <li><span>기수</span><strong>{{ profile_user.gen }}기</strong></li>
                </ul>
                {% else %}
                <ul>
                    <li><span>이름</span><strong>비공개</strong></li>
                    <li><span>학번</span><strong>비공개</strong></li>
                    <li><span>기수</span><strong>비공개</strong></li>
                </ul>
                {% endif %}
            </div>
        </aside>

        <section class="activity-content">
            <nav class="activity-tabs">
                <ul>
                    <li><a href="#" id="posts-tab" class="active">작성 게시글</a></li>
                    <li><a href="#" id="comments-tab">작성 댓글</a></li>
                </ul>
            </nav>

            {# --- 수정: 활동 내역은 항상 표시되도록 변경 --- #}
            <div id="posts-list" class="activity-list">
                <ul>
                    {% if user_posts %}
                        {% for post in user_posts %}
                        <li>
                            <div class="post-info">
                                <a href="{{ url_for('post_detail', post_id=post.id) }}" class="post-title">{{ post.title }}</a>
                                <p class="post-meta">{{ post.board_name }} ・ {{ post.updated_at|datetime }}</p>
                            </div>
                            <div class="post-stats">
                                <span>댓글 {{ post.comment_count }}</span>
                            </div>
                        </li>
                        {% endfor %}
                    {% else %}
                        <li class="no-posts-message">작성한 게시글이 없습니다.</li>
                    {% endif %}
                </ul>
            </div>

            <div id="comments-list" class="activity-list" style="display: none;">
                <ul>
                    {% if user_comments %}
                        {% for comment in user_comments %}
                        <li>
                            <div class="post-info">
                                <p class="comment-content">{{ comment.content|striptags }}</p>
                                <a href="{{ url_for('post_detail', post_id=comment.post_id) }}" class="post-meta">
                                    원본 글: {{ comment.post_title }} ・ {{ comment.updated_at|datetime }}
                                </a>
                            </div>
                        </li>
                        {% endfor %}
                    {% else %}
                        <li class="no-posts-message">작성한 댓글이 없습니다.</li>
                    {% endif %}
                </ul>
            </div>
        </section>
    </main>
</div>
{% endblock %}